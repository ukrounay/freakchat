<!DOCTYPE html>
<html>
  <head>
    <title>Chat</title>
  </head>
  <body>
    <h2>WebSocket Chat</h2>
    <input id="msgInput" placeholder="Type a message..." />
    <button onclick="sendMessage()">Send</button>
    <ul id="messages"></ul>

    <script>
        const protocol = location.protocol === "https:" ? "wss" : "ws";
        const socket = new WebSocket(`${protocol}://${location.host}`);

        const userName = prompt("Enter your name:") || "Anonymous";

        socket.onmessage = function (event) {
            event.data.text().then(raw => {
                const data = JSON.parse(raw);
                const li = document.createElement('li');
                li.innerHTML = `<strong>@${data.name}</strong> ${new Date(data.time).toLocaleTimeString()}: ${data.message}`;
                document.getElementById('messages').appendChild(li);
            });
        };

        function sendMessage() {
            const input = document.getElementById('msgInput');
            if (socket.readyState === WebSocket.OPEN) {
            const message = {
                name: userName,
                message: input.value,
                time: Date.now()
            };
            socket.send(JSON.stringify(message));
            input.value = '';
            } else {
                alert('WebSocket not connected yet.');
            }
        }
    </script>


  </body>
</html>
